<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="chrome=1">

    

    <title>
      沙盒机制和文件操作 | Stago 
    </title>

    <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=1, user-scalable=no">
    
      <meta name="author" content="Shao.">
    
    

    <meta name="description" content="沙盒机制应用程序只能在为该改程序创建的文件系统中读取文件，不可以去其它地方访问，此区域被成为沙盒，所以所有的非代码文件都要保存在此，例如图像，图标，声音，映像，属性列表，文本文件等。

每个应用程序都有自己的存储空间
应用程序不能翻过自己的围墙去访问别的存储空间的内容
应用程序请求的数据都要通过权限检测，假如不符合条件的话，不会被放行。

打开模拟器沙盒目录模拟器的沙盒文件夹在mac电脑上的什么位">
<meta property="og:type" content="article">
<meta property="og:title" content="沙盒机制和文件操作 | Stago">
<meta property="og:url" content="http://yoursite.com/2014/05/15/沙盒机制和文件操作/index.html">
<meta property="og:site_name" content="Stago">
<meta property="og:description" content="沙盒机制应用程序只能在为该改程序创建的文件系统中读取文件，不可以去其它地方访问，此区域被成为沙盒，所以所有的非代码文件都要保存在此，例如图像，图标，声音，映像，属性列表，文本文件等。

每个应用程序都有自己的存储空间
应用程序不能翻过自己的围墙去访问别的存储空间的内容
应用程序请求的数据都要通过权限检测，假如不符合条件的话，不会被放行。

打开模拟器沙盒目录模拟器的沙盒文件夹在mac电脑上的什么位">
<meta property="og:updated_time" content="2017-04-01T02:50:26.000Z">
<meta name="twitter:card" content="summary">
<meta name="twitter:title" content="沙盒机制和文件操作 | Stago">
<meta name="twitter:description" content="沙盒机制应用程序只能在为该改程序创建的文件系统中读取文件，不可以去其它地方访问，此区域被成为沙盒，所以所有的非代码文件都要保存在此，例如图像，图标，声音，映像，属性列表，文本文件等。

每个应用程序都有自己的存储空间
应用程序不能翻过自己的围墙去访问别的存储空间的内容
应用程序请求的数据都要通过权限检测，假如不符合条件的话，不会被放行。

打开模拟器沙盒目录模拟器的沙盒文件夹在mac电脑上的什么位">
    
    
    
      <link rel="icon" type="image/x-icon" href="/favicon.png">
    
    <link rel="stylesheet" href="/css/uno.css">
    <link rel="stylesheet" href="/css/highlight.css">
    <link rel="stylesheet" href="/css/archive.css">
    <link rel="stylesheet" href="/css/china-social-icon.css">

</head>
<body>

    <span class="mobile btn-mobile-menu">
        <i class="icon icon-list btn-mobile-menu__icon"></i>
        <i class="icon icon-x-circle btn-mobile-close__icon hidden"></i>
    </span>

    

<header class="panel-cover panel-cover--collapsed">


  <div class="panel-main">

  
    <div class="panel-main__inner panel-inverted">
    <div class="panel-main__content">

        

        <h1 class="panel-cover__title panel-title"><a href="/" title="link to homepage">Stago</a></h1>
        <hr class="panel-cover__divider" />

        

        <div class="navigation-wrapper">

          <nav class="cover-navigation cover-navigation--primary">
            <ul class="navigation">

              
                
                <li class="navigation__item"><a href="/#blog" title="" class="blog-button">博客</a></li>
              
                
                <li class="navigation__item"><a href="http://www.jianshu.com/u/2abebbde0d3b" title="" class="">简书</a></li>
              
                
                <li class="navigation__item"><a href="http://weibo.com/1657050420/profile?topnav=1&wvr=6" title="" class="">微博</a></li>
              

            </ul>
          </nav>

          <!-- ----------------------------
To add a new social icon simply duplicate one of the list items from below
and change the class in the <i> tag to match the desired social network
and then add your link to the <a>. Here is a full list of social network
classes that you can use:

    icon-social-500px
    icon-social-behance
    icon-social-delicious
    icon-social-designer-news
    icon-social-deviant-art
    icon-social-digg
    icon-social-dribbble
    icon-social-facebook
    icon-social-flickr
    icon-social-forrst
    icon-social-foursquare
    icon-social-github
    icon-social-google-plus
    icon-social-hi5
    icon-social-instagram
    icon-social-lastfm
    icon-social-linkedin
    icon-social-medium
    icon-social-myspace
    icon-social-path
    icon-social-pinterest
    icon-social-rdio
    icon-social-reddit
    icon-social-skype
    icon-social-spotify
    icon-social-stack-overflow
    icon-social-steam
    icon-social-stumbleupon
    icon-social-treehouse
    icon-social-tumblr
    icon-social-twitter
    icon-social-vimeo
    icon-social-xbox
    icon-social-yelp
    icon-social-youtube
    icon-social-zerply
    icon-mail

-------------------------------->

<!-- add social info here -->




        </div>

      </div>

    </div>

    <div class="panel-cover--overlay"></div>
  </div>
</header>

    <div class="content-wrapper">
        <div class="content-wrapper__inner entry">
            

<article class="post-container post-container--single">

  <header class="post-header">
    
    <h1 class="post-title">沙盒机制和文件操作</h1>

    

    <div class="post-meta">
      <time datetime="2014-05-15" class="post-meta__date date">2014-05-15</time> 

      <span class="post-meta__tags tags">

          

          

      </span>
    </div>
    
    

  </header>

  <section id="post-content" class="article-content post">
    <h2 id="沙盒机制"><a href="#沙盒机制" class="headerlink" title="沙盒机制"></a>沙盒机制</h2><p>应用程序只能在为该改程序创建的文件系统中读取文件，不可以去其它地方访问，此区域被成为沙盒，所以所有的非代码文件都要保存在此，例如图像，图标，声音，映像，属性列表，文本文件等。</p>
<ul>
<li>每个应用程序都有自己的存储空间</li>
<li>应用程序不能翻过自己的围墙去访问别的存储空间的内容</li>
<li>应用程序请求的数据都要通过权限检测，假如不符合条件的话，不会被放行。</li>
</ul>
<h2 id="打开模拟器沙盒目录"><a href="#打开模拟器沙盒目录" class="headerlink" title="打开模拟器沙盒目录"></a>打开模拟器沙盒目录</h2><p>模拟器的沙盒文件夹在mac电脑上的什么位置?<br>文件都在个人用户名文件夹下的一个隐藏文件夹里，中文叫资源库，他的目录其实是Library。<br>方法1、可以设置显示隐藏文件，然后在Finder下直接打开。设置查看隐藏文件的方法如下：打开终端，输入命名<br>显示Mac隐藏文件的命令：defaults write com.apple.finder AppleShowAllFiles -bool true<br>隐藏Mac隐藏文件的命令：defaults write com.apple.finder AppleShowAllFiles -bool false<br>输完单击Enter键，退出终端，<br>重新启动Finder就可以了重启Finder：鼠标单击窗口左上角的苹果标志–&gt;强制退出–&gt;Finder–&gt;<br>现在能看到资源库文件夹了。 </p>
<p>方法2、这种方法更方便，在Finder上点-&gt;前往-&gt;前往文件夹，输入/Users/username/Library/Application Support/iPhone Simulator/ 前往。<br>username这里写你的用户名。</p>
<h2 id="目录结构"><a href="#目录结构" class="headerlink" title="目录结构"></a>目录结构</h2><p>默认情况下，每个沙盒含有3个文件夹：Documents, Library 和 tmp。因为应用的沙盒机制，应用只能在几个目录下读写文件</p>
<ul>
<li>Documents：苹果建议将程序中建立的或在程序中浏览到的文件数据保存在该目录下，iTunes备份和恢复的时候会包括此目录</li>
<li>Library：存储程序的默认设置或其它状态信息；</li>
<li>Library/Caches：存放缓存文件，iTunes不会备份此目录，此目录下文件不会在应用退出删除</li>
<li>tmp：提供一个即时创建临时文件的地方。<br>iTunes在与iPhone同步时，备份所有的Documents和Library文件。iPhone在重启时，会丢弃所有的tmp文件。<br>我们创建一个IosSandbox的项目来展开沙盒和文件读写等操作的练习。创建后找到模拟器上对应的目录。</li>
</ul>
<h2 id="文件操作"><a href="#文件操作" class="headerlink" title="文件操作"></a>文件操作</h2><ul>
<li>获取程序的Home目录<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSString *homeDirectory = NSHomeDirectory();</div><div class="line">NSLog(@&quot;path:%@&quot;, homeDirectory);</div></pre></td></tr></table></figure>
</li>
</ul>
<p>真机上的目录和模拟器不一样。</p>
<ul>
<li><p>获取获取document目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</div><div class="line">NSString *path = [paths objectAtIndex:0];</div><div class="line">NSLog(@&quot;path:%@&quot;, path);</div></pre></td></tr></table></figure>
</li>
<li><p>获取Cache目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSCachesDirectory, NSUserDomainMask, YES);</div><div class="line">NSString *path = [paths objectAtIndex:0];</div><div class="line">NSLog(@&quot;%@&quot;, path);</div></pre></td></tr></table></figure>
</li>
<li><p>获取Library目录 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div></pre></td><td class="code"><pre><div class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSLibraryDirectory, NSUserDomainMask, YES);</div><div class="line">NSString *path = [paths objectAtIndex:0];</div><div class="line">NSLog(@&quot;%@&quot;, path);</div></pre></td></tr></table></figure>
</li>
<li><p>获取Tmp目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div></pre></td><td class="code"><pre><div class="line">NSString *tmpDir = NSTemporaryDirectory();</div><div class="line">NSLog(@&quot;%@&quot;, tmpDir);</div></pre></td></tr></table></figure>
</li>
<li><p>写入文件</p>
</li>
</ul>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</div><div class="line">NSString *docDir = [paths objectAtIndex:0];</div><div class="line">if (!docDir) &#123;</div><div class="line">NSLog(@&quot;Documents 目录未找到&quot;);        </div><div class="line">&#125;</div><div class="line">NSArray *array = [[NSArray alloc] initWithObjects:@&quot;内容&quot;,@&quot;content&quot;,nil];</div><div class="line">NSString *filePath = [docDir stringByAppendingPathComponent:@&quot;testFile.txt&quot;];</div><div class="line">[array writeToFile:filePath atomically:YES];</div></pre></td></tr></table></figure>
<ul>
<li>读取文件 <figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div></pre></td><td class="code"><pre><div class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</div><div class="line">NSString *docDir = [paths objectAtIndex:0];</div><div class="line">NSString *filePath = [docDir stringByAppendingPathComponent:@&quot;testFile.txt&quot;];</div><div class="line">NSArray *array = [[NSArray alloc]initWithContentsOfFile:filePath];</div><div class="line">NSLog(@&quot;%@&quot;, array);</div></pre></td></tr></table></figure>
</li>
</ul>
<h2 id="NSFileManager"><a href="#NSFileManager" class="headerlink" title="NSFileManager"></a>NSFileManager</h2><ul>
<li><p>在Documents里创建目录<br>创建一个叫test的目录,先找到Documents的目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div></pre></td><td class="code"><pre><div class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);  </div><div class="line">NSString *documentsDirectory = [paths objectAtIndex:0];  </div><div class="line">NSLog(@&quot;documentsDirectory%@&quot;,documentsDirectory);  </div><div class="line">NSFileManager *fileManager = [NSFileManager defaultManager];  </div><div class="line">NSString *testDirectory = [documentsDirectory stringByAppendingPathComponent:@&quot;test&quot;];  </div><div class="line">// 创建目录</div><div class="line">[fileManager createDirectoryAtPath:testDirectory withIntermediateDirectories:YES attributes:nil error:nil];</div></pre></td></tr></table></figure>
</li>
<li><p>test目录下创建文件<br>创建文件怎么办呢？接着上面的代码 testPath 要用stringByAppendingPathComponent拼接上你要生成的文件名，比如test00.txt。这样才能在test下写入文件。<br>testDirectory是上面代码生成的路径哦，不要忘了。我往test文件夹里写入三个文件，test00.txt ,test22.txt,text.33.txt。内容都是写入内容，write String。</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div></pre></td><td class="code"><pre><div class="line">NSString *testPath = [testDirectory stringByAppendingPathComponent:@&quot;test00.txt&quot;];  </div><div class="line">NSString *testPath2 = [testDirectory stringByAppendingPathComponent:@&quot;test22.txt&quot;];  </div><div class="line">NSString *testPath3 = [testDirectory stringByAppendingPathComponent:@&quot;test33.txt&quot;];  </div><div class="line"></div><div class="line">NSString *string = @&quot;写入内容，write String&quot;;</div><div class="line">[fileManager createFileAtPath:testPath contents:[string  dataUsingEncoding:NSUTF8StringEncoding] attributes:nil];</div><div class="line">[fileManager createFileAtPath:testPath2 contents:[string  dataUsingEncoding:NSUTF8StringEncoding] attributes:nil];</div><div class="line">[fileManager createFileAtPath:testPath3 contents:[string  dataUsingEncoding:NSUTF8StringEncoding] attributes:nil];</div></pre></td></tr></table></figure>
</li>
<li><p>获取目录列里所有文件名<br>两种方法获取：subpathsOfDirectoryAtPath 和 subpathsAtPath</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div></pre></td><td class="code"><pre><div class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);  </div><div class="line">NSString *documentsDirectory = [paths objectAtIndex:0];  </div><div class="line">NSLog(@&quot;documentsDirectory%@&quot;,documentsDirectory);  </div><div class="line">NSFileManager *fileManage = [NSFileManager defaultManager];  </div><div class="line">NSString *myDirectory = [documentsDirectory stringByAppendingPathComponent:@&quot;test&quot;];  </div><div class="line">NSArray *file = [fileManage subpathsOfDirectoryAtPath: myDirectory error:nil]; </div><div class="line">NSLog(@&quot;%@&quot;,file);  </div><div class="line">NSArray *files = [fileManage subpathsAtPath: myDirectory ]; </div><div class="line">NSLog(@&quot;%@&quot;,files);</div></pre></td></tr></table></figure>
</li>
<li><p>fileManager使用操作当前目录</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div></pre></td><td class="code"><pre><div class="line">//创建文件管理器</div><div class="line">NSFileManager *fileManager = [NSFileManager defaultManager];</div><div class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</div><div class="line">NSString *documentsDirectory = [paths objectAtIndex:0];</div><div class="line">//更改到待操作的目录下</div><div class="line">[fileManager changeCurrentDirectoryPath:[documentsDirectory stringByExpandingTildeInPath]];</div><div class="line">//创建文件fileName文件名称，contents文件的内容，如果开始没有内容可以设置为nil，attributes文件的属性，初始为nil</div><div class="line">NSString * fileName = @&quot;testFileNSFileManager.txt&quot;;</div><div class="line">NSArray *array = [[NSArray alloc] initWithObjects:@&quot;hello world&quot;,@&quot;hello world1&quot;, @&quot;hello world2&quot;,nil];</div><div class="line">[fileManager createFileAtPath:fileName contents:array attributes:nil];</div></pre></td></tr></table></figure>
</li>
</ul>
<p>这样就创建了testFileNSFileManager.txt并把三个hello world写入文件了<br>changeCurrentDirectoryPath目录更改到当前操作目录时，做文件读写就很方便了，不用加上全路径</p>
<ul>
<li><p>删除文件</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">[fileManager removeItemAtPath:fileName error:nil];</div></pre></td></tr></table></figure>
</li>
<li><p>混合数据的读写 </p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div></pre></td><td class="code"><pre><div class="line">用NSMutableData创建混合数据，然后写到文件里。并按数据的类型把数据读出来</div></pre></td></tr></table></figure>
<ul>
<li><p>写入数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div><div class="line">12</div><div class="line">13</div><div class="line">14</div><div class="line">15</div><div class="line">16</div><div class="line">17</div><div class="line">18</div></pre></td><td class="code"><pre><div class="line">NSString * fileName = @&quot;testFileNSFileManager.txt&quot;;</div><div class="line">NSArray *paths = NSSearchPathForDirectoriesInDomains(NSDocumentDirectory, NSUserDomainMask, YES);</div><div class="line">NSString *documentsDirectory = [paths objectAtIndex:0];</div><div class="line">//获取文件路径</div><div class="line">NSString *path = [documentsDirectory stringByAppendingPathComponent:fileName];</div><div class="line">//待写入的数据</div><div class="line">NSString *temp = @&quot;nihao 世界&quot;;</div><div class="line">int dataInt = 1234;</div><div class="line">float dataFloat = 3.14f;</div><div class="line">//创建数据缓冲</div><div class="line">NSMutableData *writer = [[NSMutableData alloc] init];</div><div class="line">//将字符串添加到缓冲中</div><div class="line">[writer appendData:[temp dataUsingEncoding:NSUTF8StringEncoding]];   </div><div class="line">//将其他数据添加到缓冲中</div><div class="line">[writer appendBytes:&amp;dataInt length:sizeof(dataInt)];</div><div class="line">[writer appendBytes:&amp;dataFloat length:sizeof(dataFloat)];  </div><div class="line">//将缓冲的数据写入到文件中</div><div class="line">[writer writeToFile:path atomically:YES];</div></pre></td></tr></table></figure>
</li>
<li><p>读取刚才写入的数据：</p>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><div class="line">1</div><div class="line">2</div><div class="line">3</div><div class="line">4</div><div class="line">5</div><div class="line">6</div><div class="line">7</div><div class="line">8</div><div class="line">9</div><div class="line">10</div><div class="line">11</div></pre></td><td class="code"><pre><div class="line">//读取数据：</div><div class="line">int intData;</div><div class="line">float floatData = 0.0;</div><div class="line">NSString *stringData;</div><div class="line"></div><div class="line">NSData *reader = [NSData dataWithContentsOfFile:path];</div><div class="line">stringData = [[NSString alloc] initWithData:[reader subdataWithRange:NSMakeRange(0, [temp length])]</div><div class="line">encoding:NSUTF8StringEncoding];</div><div class="line">[reader getBytes:&amp;intData range:NSMakeRange([temp length], sizeof(intData))];</div><div class="line">[reader getBytes:&amp;floatData range:NSMakeRange([temp length] + sizeof(intData), sizeof(floatData))];</div><div class="line">NSLog(@&quot;stringData:%@ intData:%d floatData:%f&quot;, stringData, intData, floatData);</div></pre></td></tr></table></figure>
</li>
</ul>
</li>
</ul>

  </section>

  
  
</article>


            <footer class="footer">

    <span class="footer__copyright">&copy; | <a href="http://perhapsdone@163.com">Stago</a> | never lose my passion.
    
</footer>

        </div>
    </div>

    <!-- js files -->
    <script src="/js/jquery.min.js"></script>
    <script src="/js/main.js"></script>
    <script src="/js/scale.fix.js"></script>
    

    

    <script type="text/javascript" src="//cdn.mathjax.org/mathjax/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML"></script>
    <script type="text/javascript"> 
        $(document).ready(function(){
            MathJax.Hub.Config({ 
                tex2jax: {inlineMath: [['[latex]','[/latex]'], ['\\(','\\)']]} 
            });
        });
    </script>


    

    <script src="/js/awesome-toc.min.js"></script>
    <script>
        $(document).ready(function(){
            $.awesome_toc({
                overlay: true,
                contentId: "post-content",
            });
        });
    </script>


    
    
    <!--kill ie6 -->
<!--[if IE 6]>
  <script src="//letskillie6.googlecode.com/svn/trunk/2/zh_CN.js"></script>
<![endif]-->

</body>
</html>
