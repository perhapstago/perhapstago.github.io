---
 
date: 2022-10-05
category:
  - iOS
  - Swift
  - SwiftUI
tag:
  - 语法
---

# 15.数据模型和数据管理
SwiftUI中可以使用数据模型来表示应用程序的数据，并使用数据管理来更新和传递这些数据。

## 数据模型
数据模型是应用程序中的数据结构。它定义了应用程序使用的数据类型，并确定数据之间的关系。可以使用Swift语言中的结构体来定义数据模型。<br>

下面是一个简单的示例：
``` swift
struct Person: Identifiable {
    var id = UUID()
    var name: String
    var age: Int
}
``` 
定义了一个名为Person的结构体。它具有三个属性：id，name和age。id属性是一个UUID类型的唯一标识符，用于区分不同的Person实例。name和age属性分别是字符串和整数类型。<br>

注意在结构体前加了Identifiable协议，这意味着结构体有一个可以用来识别它的属性。使用UUID作为id属性，因为它是一个全局唯一的标识符。

## 数据管理
数据管理是应用程序如何管理和更新数据的过程。在SwiftUI中可以使用@State、@ObservedObject和@EnvironmentObject属性包装器来管理和更新数据。

### @State
@State属性包装器是用于管理单个视图内部数据的属性包装器。它通常用于管理与单个视图相关的简单数据。
``` swift
struct ContentView: View {
    @State var count = 0

    var body: some View {
        VStack {
            Text("Count: \(count)")
            Button("Increment") {
                count += 1
            }
        }
    }
}
``` 
使用@State属性包装器来管理count变量的状态。每次用户点击按钮时，count变量都会递增，从而更新视图。

### @ObservedObject
@ObservedObject属性包装器是用于管理从外部传递给视图的对象数据的属性包装器。它通常用于管理与单个视图相关的复杂数据。
``` swift
class PersonViewModel: ObservableObject {
    @Published var person: Person

    init(person: Person) {
        self.person = person
    }

    func updateName(_ name: String) {
        person.name = name
    }

    func updateAge(_ age: Int) {
        person.age = age
    }
}

struct PersonDetailView: View {
    @ObservedObject var viewModel: PersonViewModel

    var body: some View {
        VStack {
            TextField("Name", text: $viewModel.person.name)
            Stepper("Age: \(viewModel.person.age)", value: $viewModel.person.age, in: 0...100)
        }
    }
}
``` 
使用@ObservedObject属性包装器来管理PersonViewModel对象的状态。PersonViewModel包含了一个Person对象，以及更新Person对象的方法。使用TextField和Stepper元素展示了Person对象的属性，并使用@ObservedObject属性包装器来管理这些属性。每当用户更新TextField或Stepper中的值时，Person对象的属性都会自动更新，从而更新视图。

### @EnvironmentObject
@EnvironmentObject属性包装器是用于管理全局数据的属性包装器。它通常用于管理多个视图之间共享的数据。
``` swift
class AppState: ObservableObject {
    @Published var count = 0
}

struct ContentView: View {
    @EnvironmentObject var appState: AppState

    var body: some View {
        VStack {
            Text("Count: \(appState.count)")
            Button("Increment") {
                appState.count += 1
            }
            NavigationLink(destination: DetailView()) {
                Text("Go to detail view")
            }
        }
    }
}

struct DetailView: View {
    @EnvironmentObject var appState: AppState

    var body: some View {
        VStack {
            Text("Count: \(appState.count)")
            Button("Increment") {
                appState.count += 1
            }
        }
    }
}
``` 
创建了一个名为AppState的全局数据模型。将其标记为ObservableObject，这意味着可以使用@EnvironmentObject属性包装器在多个视图之间共享这个对象。使用@EnvironmentObject属性包装器来管理appState对象的状态。在ContentView和DetailView视图中都可以访问和更新appState对象的count属性。

## 结论
SwiftUI里数据模型和数据管理是构建强大应用程序的基础。使用数据模型来表示应用程序的数据结构，并使用数据管理来更新和传递这些数据。通过使用@State、@ObservedObject和@EnvironmentObject属性包装器可以轻松地管理和更新数据。