import{colors as $,fs as L}from"@vuepress/utils";import{Logger as M,entries as W,isAbsoluteUrl as O,isUrl as y,stripTags as q,getPageText as z,getAuthor as _,getDate as G,startsWith as K}from"vuepress-shared/node";import{isString as I,isLinkHttp as Q,removeEndingSlash as P,removeLeadingSlash as V,isArray as X,isFunction as Y}from"@vuepress/shared";const s=new M("vuepress-plugin-seo2"),U=({lang:t,path:e,pathLocale:a},{pages:n,siteData:r})=>W(r.locales).map(([o,{lang:i}])=>({path:`${o}${e.replace(a,"")}`,lang:i})).filter(o=>I(o.lang)&&o.lang!==t&&n.some(({path:i})=>i===o.path)),B=({frontmatter:t},{options:{base:e}},{hostname:a})=>{const{banner:n,cover:r}=t;if(n){if(O(n))return f(a,e,n);if(y(n))return n}if(r){if(O(r))return f(a,e,r);if(y(r))return r}return null},C=({content:t},{options:{base:e}},{hostname:a})=>{const n=/!\[.*?\]\((.*?)\)/giu.exec(t);return n?n.map(([,r])=>O(r)?f(a,e,r):y(r)?r:null).filter(r=>r!==null):[]},f=(t,e,a)=>`${Q(t)?P(t):`https://${P(t)}`}${e}${V(a)}`,H=(t,e,a="",n="")=>{e in t&&(s.error(`"${$.magenta(e)}" is ${$.red("removed")}${n?`, please use ${$.magenta(n)} instead.`:" and no longer supported"}${a?`
${a}`:""}`),n||delete t[e])},Z=t=>{H(t,"seo","","ogp"),H(t,"customMeta","","customHead")},tt=(t,e=!0)=>{if(!t.frontmatter.description&&e){if(t.data.excerpt)t.frontmatter.description=q(t.data.excerpt).replace(/(?:\r?\n)+/g," ").replace(/ +/g," ").trim();else{const a=z(t);t.frontmatter.description=a.length>180?`${a.slice(0,177)}...`:a}t.data.autoDesc=!0}},et=(t,e,a)=>{var n,r,o,i,l;const{isArticle:c=w=>Boolean(w.filePathRelative&&!w.frontmatter.home),author:g}=e,{options:{base:x},siteData:d}=a,{frontmatter:{author:m,time:S,date:D=S,tag:u,tags:v=u},data:{git:h={}}}=t,p=((n=d.locales[t.pathLocale])==null?void 0:n.title)||d.title||((r=d.locales["/"])==null?void 0:r.title)||"",j=m===!1?[]:_(m||g),b=h.updatedTime?new Date(h.updatedTime).toISOString():null,F=X(v)?v:I(u)?[u]:[],k=t.title,J=B(t,a,e),N=C(t,a,e),R=U(t,a),T=(i=(o=G(D))==null?void 0:o.value)==null?void 0:i.toISOString(),E=J||N[0]||e.fallBackImage||"";return{"og:url":f(e.hostname,x,t.path),"og:site_name":p,"og:title":k,"og:description":t.frontmatter.description||"","og:type":c(t)?"article":"website","og:image":E,"og:locale":t.lang,"og:locale:alternate":R.map(({lang:w})=>w),...b?{"og:updated_time":b}:{},...e.restrictions?{"og:restrictions:age":e.restrictions}:{},...e.twitterID?{"twitter:creator":e.twitterID}:{},...E?{"twitter:card":"summary_large_image","twitter:image:alt":k}:{},"article:author":(l=j[0])==null?void 0:l.name,"article:tag":F,...T?{"article:published_time":T}:{},...b?{"article:modified_time":b}:{}}},at=(t,e,a)=>{var n,r;const{isArticle:o=p=>Boolean(p.filePathRelative&&!p.frontmatter.home),author:i}=e,{title:l,frontmatter:{author:c,description:g,time:x,date:d=x},data:{git:m={}}}=t,S=c===!1?[]:_(c||i),D=(r=(n=G(d))==null?void 0:n.value)==null?void 0:r.toISOString(),u=m.updatedTime?new Date(m.updatedTime).toISOString():null,v=B(t,a,e),h=C(t,a,e);return o(t)?{"@context":"https://schema.org","@type":"Article",headline:l,image:h.length?h:[v||e.fallBackImage||""],datePublished:D,dateModified:u,author:S.map(p=>({"@type":"Person",...p}))}:{"@context":"https://schema.org","@type":"WebPage",name:l,...g?{description:g}:{}}},nt=(t,e)=>Y(e.canonical)?e.canonical(t):I(e.canonical)?`${P(e.canonical)}${t.path}`:null,rt=(t,{hostname:e},a)=>U(t,a).map(({lang:n,path:r})=>({lang:n,path:f(e,a.options.base,r)})),A=(t,{name:e,content:a,attribute:n=["article:","og:"].some(r=>K(e,r))?"property":"name"})=>{a&&t.push(["meta",{[n]:e,content:a}])},ot=(t,e)=>{for(const a in e)switch(a){case"article:tag":e["article:tag"].forEach(n=>A(t,{name:"article:tag",content:n}));break;case"og:locale:alternate":e["og:locale:alternate"].forEach(n=>{n!==e["og:locale"]&&A(t,{name:"og:locale:alternate",content:n})});break;default:e[a]&&A(t,{name:a,content:e[a]})}},it=(t,e)=>{t.push(["script",{type:"application/ld+json"},JSON.stringify(e)])},lt=(t,e)=>{e&&t.push(["link",{rel:"canonical",href:e}])},st=(t,e)=>{e.forEach(({lang:a,path:n})=>{t.push(["link",{rel:"alternate",hreflang:a.toLowerCase(),href:n}])})},ct=(t,e)=>{t.pages.forEach(a=>{const n=a.frontmatter.head||[],r=nt(a,e),o=rt(a,e,t);if(lt(n,r),st(n,o),a.frontmatter.seo!==!1){const i=et(a,e,t),l=at(a,e,t),c=e.ogp?e.ogp(i,a,t):i,g=e.jsonLd?e.jsonLd(l,a,t):l;ot(n,c),it(n,g),e.customHead&&e.customHead(n,a,t)}a.frontmatter.head=n})},gt=async t=>{s.load("Generating robots.txt");const e=t.public("robots.txt");let a=L.existsSync(e)?await L.readFile(e,{encoding:"utf8"}):"";a&&!a.includes("User-agent")?(s.error(),s.update("robots.txt seems invalid!")):(a+=`
User-agent:*
Disallow:
`,await L.writeFile(t.dest("robots.txt"),a,{flag:"w"}),s.succeed())},pt=(t,e=!0)=>a=>{e&&Z(t),a.env.isDebug&&s.info("Options:",t);const n={name:"vuepress-plugin-seo2"};return t.hostname?{...n,extendsPage:r=>{r.frontmatter.seo!==!1&&tt(r,t.autoDescription!==!1)},onInitialized:r=>{ct(r,t)},onGenerated:r=>gt(r.dir)}:(s.error(`Option ${$.magenta("hostname")} is required!`),n)};export{pt as seoPlugin};
//# sourceMappingURL=index.js.map
