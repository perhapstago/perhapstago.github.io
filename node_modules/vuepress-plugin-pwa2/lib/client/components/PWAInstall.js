import{defineComponent as m,ref as s,onMounted as h,h as e,computed as g}from"vue";import{useLocaleConfig as f}from"vuepress-shared/client";import{withBase as I}from"@vuepress/client";import{useEventListener as b}from"@vueuse/core";import{l as w,C,A as y,a as A}from"../define-3fd15ee3.js";import"../styles/modal.scss";var k=m({name:"PWAInstallModal",props:{useHint:Boolean},emits:{canInstall:c=>!0,hint:()=>!0,toggle:c=>!0},setup(c,{emit:n}){const o=f(w),l=s({}),i=s(),u=async()=>{const t=localStorage.getItem("manifest");if(t)l.value=JSON.parse(t);else try{const a=await(await fetch(I("manifest.webmanifest"))).json();l.value=a,localStorage.setItem("manifest",JSON.stringify(a))}catch{console.error("[PWA]: Error getting manifest, check that you have a valid web manifest or network connection")}},r=()=>{const t=document.querySelector(".screenshot");t&&t.scrollBy({left:-t.clientWidth,top:0,behavior:"smooth"})},v=()=>{const t=document.querySelector(".screenshot");t&&t.scrollBy({left:t.clientWidth,top:0,behavior:"smooth"})},d=async()=>{i.value&&(i.value.prompt(),document.dispatchEvent(new CustomEvent("show")),(await i.value.userChoice).outcome==="accepted"?(console.info("PWA has been installed"),n("toggle",!1),n("canInstall",!1)):(console.info("You choose to not install PWA"),n("toggle",!1),n("canInstall",!1)))},p=()=>{console.info("You accepted the install hint"),n("hint")};return h(()=>{window.hasOwnProperty("BeforeInstallPromptEvent")&&(b(window,"beforeinstallprompt",t=>{i.value=t,n("canInstall",!0),t.preventDefault(),b("keyup",a=>{a.key==="Escape"&&n("toggle",!1)})}),u())}),()=>{var t;return e("div",{id:"install-modal-wrapper"},[e("div",{class:"background",onClick:()=>n("toggle",!1)}),e("div",{class:"install-modal"},[e("div",{class:"header"},[e("button",{class:"close-button","aria-label":o.value.close,onClick:()=>n("toggle",!1)},e(C)),e("div",{class:"logo"},[l.value.icons?e("img",{src:(t=l.value.icons[0])==null?void 0:t.src,alt:"App Logo"}):null,e("div",{class:"title"},[e("h1",l.value.short_name||l.value.name),e("p",{class:"desc"},o.value.explain)])])]),e("div",{class:"content"},[e("div",{class:"highlight"},[l.value.features?e("div",{class:"feature-wrapper"},[e("h3",o.value.feature),e("ul",l.value.features.map(a=>e("li",a)))]):null,l.value.screenshots?e("div",{class:"screenshot-wrapper"},[e("button",{"aria-label":o.value.prevImage,onClick:r},e(y)),e("section",{class:"screenshot"},[l.value.screenshots.map(a=>e("div",e("img",{src:a.src,alt:"App Screenshot"})))]),e("button",{"aria-label":o.value.nextImage,onClick:v},e(A))]):null]),e("div",{class:"description"},[e("h3",o.value.desc),e("p",l.value.description)])]),c.useHint?e("div",{class:"ios-text",onClick:p},[e("p",o.value.iOSInstall),e("button",{class:"success"},"Got it!")]):e("div",{class:"button-wrapper"},[e("button",{class:"install-button",onClick:d},[o.value.install,e("span",l.value.short_name)]),e("button",{class:"cancel-button",onClick:()=>n("toggle",!1)},o.value.cancel)])])])}}}),S=m({name:"PWAInstall",setup(){const c=f(w),n=s(!1),o=s(!1),l=s(!1),i=s(!1),u=s(!1),r=s(!1),v=g(()=>i.value&&u.value&&r.value===!1),d=g(()=>o.value&&n.value||v.value),p=()=>navigator.standalone?navigator.standalone:matchMedia("(display-mode: standalone)").matches,t=()=>{l.value=!1,r.value=!0,localStorage.setItem("iOS-pwa-hint","hinted")};return h(()=>{if(p()){const{userAgent:a}=navigator;i.value=a.includes("iPhone")||a.includes("iPad")||Boolean(a.includes("Macintosh")&&navigator.maxTouchPoints&&navigator.maxTouchPoints>2),u.value=navigator.userAgent.includes("Safari")&&!a.includes("Chrome"),r.value=Boolean(localStorage.getItem("iOS-pwa-hint"))}"getInstalledRelatedApps"in navigator&&navigator.getInstalledRelatedApps().then(a=>{o.value=a.length>0})}),()=>e("div",{id:"pwa-install"},[d.value?e("button",{class:"modal-button",useHint:v.value,onClick:()=>{l.value=!0}},c.value.install):null,e(k,{style:{display:l.value?"block":"none"},onCanInstall:a=>{n.value=a},onHint:()=>t(),onToggle:a=>{l.value=a}})])}});export{S as default};
//# sourceMappingURL=PWAInstall.js.map
